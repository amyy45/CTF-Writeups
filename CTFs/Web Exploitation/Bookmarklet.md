# üß© CTF Challenge Writeup  
**Challenge Name:** Bookmarklet  
**Category:** Web Exploitation  
**Difficulty:** Easy  
**Platform:** picoCTF 2024  
**Author:** Jeffery John  
**Date:** 28-01-26  

---

## üîç 1. Challenge Description

The challenge presents a simple web page with the following description:

> *‚ÄúWhy search for the flag when I can make a bookmarklet to print it for me?‚Äù*  

The page provides a link to browse a website and asks the user to **find the flag**.  
A visible hint suggests the use of a **bookmarklet**, which is a browser bookmark that executes JavaScript code in the context of the currently open page.

This immediately implies that:
- The flag is already present **client-side**
- The solution does **not** require server-side exploitation
- JavaScript execution in the browser is the intended attack vector

---

## üß† 2. Initial Thoughts / Approach

Given:
- **Web Exploitation** category  
- **Easy** difficulty  
- Explicit mention of a **bookmarklet**

Key observations:
- Bookmarklets execute JavaScript with access to the page‚Äôs DOM
- Any sensitive data stored in JavaScript variables or HTML can be accessed
- Client-side obfuscation does **not** provide real security

The goal is therefore to **inspect the page source**, locate the bookmarklet code, and execute it correctly to reveal the flag.

---

## üõ†Ô∏è 3. Steps to Solve

### 3.1 Launch the Challenge Instance
Click the **‚ÄúBrowse here‚Äù** link to open the challenge webpage.
### 3.2 Inspect the Page Source
Open **Developer Tools** (`Ctrl + Shift + I`) and inspect the HTML.

Inside the page, a `<textarea>` element with the ID `bookmarkletCode` is found:

```html
<textarea id="bookmarkletCode" readonly>
javascript:(function() {
  var encryptedFlag = "√†√í√Ü√û!√à¬¨√´√õ√â√ñ  √î√õ√•√õ√ë¬¢√î  √î √á¬° ¬•√é√≠";
  var key = "picoctf";
  var decryptedFlag = "";
  for (var i = 0; i < encryptedFlag.length; i++) {
    decryptedFlag += String.fromCharCode(
      (encryptedFlag.charCodeAt(i)
      - key.charCodeAt(i % key.length)
      + 256) % 256
    );
  }
  alert(decryptedFlag);
})();
</textarea>
```
This confirms:
- The flag is encrypted client-side
- A simple repeating-key cipher is used
- The key is clearly visible: picoctf
### 3.3 Initial Decryption Attempt
Running the decryption logic manually or copying the encrypted string into the console results in garbled output due to character encoding corruption.

This occurs because:
- The encrypted string contains raw byte values
- Copy-pasting visually alters the byte sequence
- The decryption logic remains correct, but the input is no longer valid
### 3.4 Correct Execution Method (Core Exploit)
Instead of copying the encrypted string manually, the bookmarklet code must be extracted directly from the DOM to preserve the original byte values.

In the browser console, the following commands are executed:
```js
let code = document.getElementById("bookmarkletCode").value;
eval(code.replace(/^javascript:/, ""));
```
This:
- Reads the original bookmarklet code from the page
- Removes the javascript: prefix
- Executes the code exactly as intended
### 3.5 Flag Reveal
Executing the code triggers an alert displaying the decrypted flag:
```text
picoCTF{p@g3_turn3r_0c0d211f}
```

---
## üß©  4. Final Flag 
```bash
picoCTF{p@g3_turn3r_0c0d211f}
```

---
## üìö 5. Key Learnings
- Bookmarklets execute JavaScript with full access to the page context
- Client-side encryption provides no real protection if keys are exposed
- Copy-pasting obfuscated strings can corrupt byte-level data
- Always extract sensitive client-side data programmatically
- DOM inspection is a critical skill for web exploitation challenges

---
## üöÄ 6. Improvements for Next Time
- Avoid manually copying encrypted or obfuscated data
- Prefer DOM-based extraction (element.value, innerText)
- Be cautious of encoding issues when working with JavaScript strings
- Treat client-side logic as fully attacker-controlled
- Recognize when execution is more important than analysis

---
## üîó 7. References
- OWASP Top 10 ‚Äì Sensitive Data Exposure
- MDN Web Docs ‚Äì Bookmarklets
- MDN Web Docs ‚Äì JavaScript eval()
- picoCTF Web Exploitation Challenges